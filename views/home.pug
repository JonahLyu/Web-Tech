extends layout.pug

block layout-content
    .search-area-wrapper
      .search-area.container
        h3#greeting.search-header
        //- h3#greeting.search-header Howdy, #{userProfile.nickname}!
        p.search-tag-line Welcome back to your magic forum!
        form#search-form.search-form.clearfix(method="get" action="/forum/search" autocomplete="off")
          input#s.search-term.required(type="text" name="input" placeholder="Type your search terms here" title="* Please enter a search term!")
          input.search-btn(type="submit" value="Search")
          #search-error-container
    .page-container
        .container
            .row
                //- .span4
                .span8.main-listing
                    h1 Most Popular Posts
                    each post in posts
                        article.type-post.hentry.clearfix
                          header.clearfix
                            h3.post-title
                                a(href="/forum/loadPost?id="+post.PostID) #{post.Title}
                            .post-meta.clearfix
                              span.date #{post.Date}
                              span.category
                                a(href="/forum/loadCategory?id="+post.CatID+"&title="+post.Category title="View all posts in " + post.Category) #{post.Category}
                              span.comments
                                a(href="/forum/loadPost?id="+post.PostID title="Comment") #{post.CommentCount} Comments
                              span.like-count(value=post.PostID) #{post.LikeCount}
                              span.author
                                a(href="/forum/loadUser?id="+post.UserID tile="View " + post.Author + "'s profile'") #{post.Author}
                              if userProfile.user_id == post.UserID || level > 2
                                span 
                                    form#delete.form-inline(action="/forum/deletePost" method="POST")
                                        input#postid(name="postid", value=post.PostID, type="hidden")
                                        button#post.btn.btn-mini.btn-info(type="submit" name="submit" title="delete this post") Delete
                          p.content
                            | #{post.Content} 
                            a.readmore-link(href="/forum/loadPost?id="+post.PostID) Read more
                    h1 Categories
                    each cat in cats
                        article.type-cat.hentry.clearfix
                          header.clearfix
                            .cat-meta
                              span
                                img(src="/images/tag.svg" width="32" height="32" alt="")
                              span
                                h3(style="display:inline;")
                                  a(href="/forum/loadCategory?id="+cat.CatID+"&title="+cat.Title) #{cat.Title}
                            .post-meta
                              span.comments
                                a(href="/forum/loadCategory?id="+cat.CatID+"&title="+cat.Title title="Posts") #{cat.PostCount} Posts
                              if level > 2
                                span 
                                    button#post.btn.btn-mini.btn-danger(onclick="confirmDelete("+cat.CatID+")" title="Delete this category") Delete
                            p.content.cat-description
                                | #{cat.Description} 
                //- .span8
                //-   h3.title Categories
                //-     ul
                //-       each cat in cats
                //-         li
                //-           a(href="/forum/loadCategory?id="+cat.CatID+"&title="+cat.Title) #{cat.Title}
                .span4
                    section.widget
                        .info-widget
                            .avatar-wrap
                                img#userAvatar.avatar.avatar-60.photo(alt="" src="/images/support.png" height="60" width="60")
                            div.Title
                                h3 Your info
                            .username-wrap
                                b Username: 
                                span#username 
                            .gender-wrap
                                b Gender: 
                                span#gender 
                            .birthday-wrap
                                b Birthday: 
                                span#birthday 
                            .phone-wrap
                                b Phone: 
                                span#phone 
                    section.widget
                        .support-widget
                            h3.title New Post
                            form(action="/forum/createPost" method="POST")
                                select#selectCat.form-control(name='category')
                                    option(value='-1', selected= true) -- Select Category --
                                    each cat,index in cats
                                      option(value=cat.CatID,selected=false) #{cat.Title}
                                br
                                input#title.form-control(type='text', name='title', placeholder='your title')
                                br
                                textarea#content.form-control(name="content", rows='5', cols='20', placeholder='your content')
                                br
                                button#post.btn.btn-primary(type="submit" name="submit") post
                    if level === 3
                      section.widget
                        .support-widget
                            h3.title New Category
                            form(action="/forum/createCategory" method="POST")
                                textarea#content.form-control(name="title", rows='1', cols='20', placeholder='Category Name')
                                br
                                textarea#content.form-control(name="description", rows='5', cols='20', placeholder='Category Description')
                                br
                                button#post.btn.btn-primary(type="submit" name="submit") Create Category              

        script(src="../scripts/home.js")
        script(src="http://www.myersdaily.org/joseph/javascript/md5.js")
        script.
            $(document).ready(function(){
                $.post(
                    "/users/info",
                    function(data) {
                        let hash = md5(data.UserID)
                        let avatarLink = "https://www.gravatar.com/avatar/" + hash + "?d=monsterid"
                        $("#userAvatar").attr("src", avatarLink);
                        $("#greeting").html("Howdy, " + data.Username + "!");
                        $("#username").html(data.Username);
                        $("#birthday").html(data.Birthday);
                        $("#gender").html(data.Gender);
                        $("#phone").html(data.Phone);
                    }
                );
                
                //- $.getJSON(
                //-     "/forum/getCategory",
                //-     function(data) {
                //-         for (var i=0;i<data.length;i++){ 
                //-             $("#selectCat").append("<option value='"+data[i].CatID+"'>"+data[i].Title+"</option>");
                //-         }
                //-     }
                //- ); 
                   
            });   
        
            
